<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Serving Retina Images to Devices that Need them &middot; Kakuweb Blog
    
  </title>


    <!-- This is a header with the pages_list array declared in config.yml -->
<!--
    <h3 class="masthead-title">
    <a href="/" title="Home">Kakuweb Blog</a>

    
    </h3>
-->

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-08 layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Hodgepodge bunch of stuff, mostly related to programming but really anything I feel like ranting about.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Posts</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/novel/">My Novel</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    


  <!-- listing the latest 10 entries -->
    <section>
        <span class="sidebar-nav-item">Recent Posts</span>
        <ul>
        
          <li>
            <a href="/2017/01/19/buying-a-new-videogame/">The sure-fire way to buy a new video game</a>
          </li>
        
          <li>
            <a href="/2017/01/15/back-to-work/">Back to work</a>
          </li>
        
          <li>
            <a href="/2017/01/14/move-to-london/">So you want to move to London</a>
          </li>
        
          <li>
            <a href="/2016/02/24/Tap-Gesture-and-TableView/">Using a Tap Gesture That Doesn't Interfere with a TableView in iOS</a>
          </li>
        
          <li>
            <a href="/2016/02/24/Close-iOS-Keyboard/">Best Way to Close the iOS Keyboard</a>
          </li>
        
          <li>
            <a href="/2016/02/05/Apple-Music-HipHop/">Apple Radio = The HipHop Channel</a>
          </li>
        
          <li>
            <a href="/2016/02/04/Bicycle-Wheel-Sizes/">Bicycle Wheel Sizes</a>
          </li>
        
          <li>
            <a href="/2015/08/19/Swift-is-cool/">Swift is Actually Cool!</a>
          </li>
        
          <li>
            <a href="/2015/08/19/Apple-Watch-is-a-gimmick/">The Apple Watch is a Gimmick</a>
          </li>
        
          <li>
            <a href="/2015/06/05/Irony-of-To-Do-Apps/">The Irony of To Do Apps</a>
          </li>
        
        </ul>
    </section>

    <span class="sidebar-nav-item">Currently v0.7</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Kakuweb Blog</a>
            <small>Rants and raves. Some interesting stuff, most of it not.</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Serving Retina Images to Devices that Need them</h1>
  <span class="post-date">07 Apr 2014</span>
  <h3 id="update-chrome-34-released-around-april-9-2014-is-supposed-to-have-support-for-the-srcset-attribute-read-on-to-find-out-what-that-means"><em>Update:</em> <code class="highlighter-rouge">Chrome 34</code> (released around April 9 2014) is supposed to have support for the <code class="highlighter-rouge">srcset</code> attribute. Read on to find out what that means.</h3>

<p>Retina Macs are a pain in the arse for web developers, now we have to deal with 2 sets of images for everything or run the risk of suffering the unending wrath of Retina Mac users who will invariably let you know that image X looks fuzzy on their screen. When did fuzzy images become a capital crime? And it’s not like I’m talking horrible, pixelated images, no, just a bit fuzzy which all of a sudden is completely unacceptable.</p>

<p>This is an issue that affects mainly the Macs because on the iPad and iPhone, even with Retina displays, the screen size and pixel density are such that a non-retina image is a lot less noticeable.</p>

<p>It would be interesting to figure out what percentage of our web viewers actually have a retina display Mac before we go and spend hours trying to cater to a small minority.</p>

<p>So what’s a web developer to do?</p>

<h2 id="option-1">Option 1</h2>
<p>Just serve huge images to everybody. This is the easiest thing to do, but you still need some work for things to look good on the bloody retina displays, you need to set your image width and height to half the actual size or it will still look (oh no!) <em>fuzzy</em>.</p>

<p>Here’s an example, say your image is 1024 x 960 pixels, this is how you need to present it.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"retina-image@2x.png"</span> <span class="na">width=</span><span class="s">"512"</span> <span class="na">height=</span><span class="s">"480"</span><span class="nt">&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="o">//</span> <span class="nt">with</span> <span class="nt">CSS</span>
<span class="o">&lt;</span><span class="nt">img</span> <span class="nt">src</span><span class="o">=</span><span class="s1">"retina-image@2x.png"</span> <span class="nt">style</span><span class="o">=</span><span class="s1">"width: 512px; height: 480px;"</span><span class="o">&gt;</span></code></pre></figure>

<p>Of course you want to avoid HTML attributes and inline CSS so you can create a class for it.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"retina-image@2x.png"</span> <span class="na">class=</span><span class="s">"retina-pain-in-the-arse"</span><span class="nt">&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="o">//</span> <span class="nt">CSS</span>
<span class="nc">.retina-pain-in-the-arse</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
    <span class="err">//</span> <span class="err">You'll</span> <span class="err">need</span> <span class="err">some</span> <span class="err">extra,</span> <span class="err">tricky</span> <span class="err">CSS</span> <span class="err">to</span> <span class="err">get</span> <span class="err">the</span> <span class="err">image</span> <span class="err">to</span> <span class="err">display</span> <span class="err">at</span> <span class="err">the</span> <span class="err">size</span> <span class="err">you</span> <span class="err">want.</span>
<span class="p">}</span></code></pre></figure>

<p>The downside to this method is, of course, you’re serving huge images, even to the majority who don’t have a fancy new retina display.</p>

<p>And the <code class="highlighter-rouge">width: 50%</code> in the CSS won’t help you get the image at the size you want, that’s a bit tricker and you might have to do it on an individual basis which is bad news all around.</p>

<h2 id="option-2">Option 2</h2>
<p>Use Safari’s fancy new-fangled <code class="highlighter-rouge">srcset</code> tag to serve retina images. It sounds great. Supposedly webkit has this new tag where you specify the name of the retina image and the browser will only load the needed one. It’s supposed to be like this:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"normal-image.png"</span> <span class="na">srcset=</span><span class="s">"big-ass-retina-image.png 2x"</span><span class="nt">&gt;</span></code></pre></figure>

<p>Note the <code class="highlighter-rouge">2x</code> at the end of the name, no, that’s not a typo, that’s what the spec says to use. Safari is supposed to look at this and determine which image it will serve depending on the device. Sounds awesome. The best part: it will <strong>not</strong> load both images, just the one it needs to render, everybody wins.</p>

<p><strong>The bad news:</strong> this doesn’t seem to work, that is, there is no support on the main browsers for it at the moment, which is a bit strange considering that this change came out for webkit in August 2013. Safari 7 in Mavericks was supposed to have it but it doesn’t, nor does Safari for iOS 7.1 either. I read somewhere that the latest version of Chrome (or Chrmomium, the poster wasn’t too sure) supports this but in my tests with <code class="highlighter-rouge">Chrome 33.0.1750.152</code> downloaded yesterday it doesn’t work.</p>

<p>So, useless for the time being, keep it around for the future if you already changed your web pages.</p>

<p>Read the blog post <a href="https://www.webkit.org/blog/2910/improved-support-for-high-resolution-displays-with-the-srcset-image-attribute/">straight from the horses mouth</a>.</p>

<h2 id="option-3">Option 3</h2>
<p>Use Javascript to serve the retina images only for retina devices. This seems to be the best option so far (see option 2 as to why that is). We use a little javascript to overwrite the image source tag if we detect a retina device.</p>

<p>This is a javascript I stole from my brother who in turn stole it from some dude on the internet. I had to change it to actually make it work because, as usual, the code he sent me was full of errors.</p>

<p>Presented here in Coffeescript because I hate Javascript (is there an uglier modern language that javascript out there?):</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="nx">images</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"img"</span><span class="p">)</span>
    <span class="nx">arrayLength</span> <span class="o">=</span> <span class="nx">images</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arrayLength</span>
      <span class="nx">imgTag</span> <span class="o">=</span> <span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="nx">attr</span> <span class="o">=</span> <span class="nx">imgTag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">"srcset"</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">attr</span>
        <span class="nx">firstToSpace</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"attr is: "</span> <span class="o">+</span> <span class="nx">attr</span><span class="p">)</span>
        <span class="nx">imgTag</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">firstToSpace</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"And firstToSpace is: "</span> <span class="o">+</span> <span class="nx">firstToSpace</span><span class="p">)</span>
      <span class="nx">i</span><span class="o">++</span>
<span class="k">return</span></code></pre></figure>

<p>Alright, for you Javascript perverts:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">arrayLength</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">firstToSpace</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">images</span><span class="p">,</span> <span class="nx">imgTag</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">images</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"img"</span><span class="p">);</span>
    <span class="nx">arrayLength</span> <span class="o">=</span> <span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arrayLength</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">imgTag</span> <span class="o">=</span> <span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">attr</span> <span class="o">=</span> <span class="nx">imgTag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">"srcset"</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">firstToSpace</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"attr is: "</span> <span class="o">+</span> <span class="nx">attr</span><span class="p">);</span>
        <span class="nx">imgTag</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">firstToSpace</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"And firstToSpace is: "</span> <span class="o">+</span> <span class="nx">firstToSpace</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="k">return</span><span class="p">;</span></code></pre></figure>

<p>I’ve left the console logs in there so you can see if the damn thing is working or not.</p>

<p>What it does is very simple:</p>

<p>Since we had already used the new-fangled, useless <code class="highlighter-rouge">srcset</code> tag, we leverage that to overwrite the image source, it works like this:</p>

<ol>
  <li>Checks to see if the device is a retina device based on Pixel Ratio being greater than 1</li>
  <li>then picks up all the images in the page</li>
  <li>checks to see if they have the <code class="highlighter-rouge">srcset</code> attribute</li>
  <li>if they do have the attribute, it takes the image name from that attribute,</li>
  <li>removes the space and <code class="highlighter-rouge">2x</code> at the end of the name, hence grabbing the name of the high-res image</li>
  <li>and overwrites the <code class="highlighter-rouge">src</code> attribute with this new, high-res image.</li>
</ol>

<p>Simple. The nice thing about this script is that it’s short, simple and you can leave the <code class="highlighter-rouge">srcset</code> in there for the future when the major browsers start supporting it, at which time you simply remove the call for the javascript and things should work (fingers crossed).</p>

<p>What if you don’t want to use the damn <code class="highlighter-rouge">srcset</code>? Or if you don’t, rightly, trust my Javascript skills?</p>

<p>Then your best bet is probably to use javascript written by someone who actually knows javascript, like this one right here: <a href="http://retinajs.com/">retina.js</a> which seems to be the most popular out there.</p>

<p>Downsides to both this script and the retina.js one, a couple:</p>

<ol>
  <li>The browser will load <strong>both</strong> images, making your pages take longer to load, <strong>even if you’re not serving the retina images</strong>, this sucks!</li>
  <li>Pages will be slower on <strong>all</strong> devices, this is especially bad on mobile devices which have less capable CPUs and already takes them longer to render images and pages.</li>
</ol>

<p>However, this is the best option I’ve found so far to serve retina images. If you know of something better, by all means, get in touch and let us know.</p>

<p>Cheers.</p>

</div>

<img src="/images/twitter_logo_blue.png" alt="Twitter" style="width: 30px; float: left; margin-right: 10px;">
<a href="https://twitter.com/intent/tweet?url=http://localhost:4000/2014/04/07/serving-retina-images-to-devices-that-need-them/&text=Serving Retina Images to Devices that Need them&via=kakubei"
   target="_blank">Share this post </a>if you want,
or
<a href="https://twitter.com/kakubei">
  follow me on Twitter</a> if you're into that stuff.

<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'noirnovel'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2017/01/19/buying-a-new-videogame/">
            The sure-fire way to buy a new video game
            <small>19 Jan 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/01/15/back-to-work/">
            Back to work
            <small>15 Jan 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/01/14/move-to-london/">
            So you want to move to London
            <small>14 Jan 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50242492-1', 'kakubei.github.io');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>


  </body>
</html>
